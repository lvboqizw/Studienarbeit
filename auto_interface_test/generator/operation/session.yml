name: $SESSION_NAME
version: "0.3"

security:
  attestation:
        tolerate: [debug-mode, insecure-configuration, outdated-tcb, software-hardening-needed]
        ignore_advisories: "*"

services:
   - name: server
     mrenclaves: [$MREN_SERVER]
     environment:
      #  SCONE_LOG: debug
       SCONE_NETWORK_SHIELD: "protected"
       SCONE_NETWORK_SHIELD_SERVER_1: "protected"
       SCONE_NETWORK_SHIELD_SERVER_1_PORT: "TCP:9000"
       SCONE_NETWORK_SHIELD_SERVER_1_IDENTITY: |
         $$SCONE::server:privatekey$$
         $$SCONE::server:crt$$
       SCONE_NETWORK_SHIELD_SERVER_1_CLIENT_AUTH: |
         $$SCONE::client_ca:crt$$
   
   - name: client
     mrenclaves: [$MREN_CLIENT]
     environment:
      #  SCONE_LOG: debug
       SCONE_NETWORK_SHIELD: "protected"
       SCONE_NETWORK_SHIELD_CLIENT_1: "protected"
       SCONE_NETWORK_SHIELD_CLIENT_1_DESTINATION: "TCP:localhost:9000"
       SCONE_NETWORK_SHIELD_CLIENT_1_DESTINATION_IP: "127.0.0.1"
       SCONE_NETWORK_SHIELD_CLIENT_1_IDENTITY: |
         $$SCONE::client:privatekey$$
         $$SCONE::client:crt$$
       SCONE_NETWORK_SHIELD_CLIENT_1_SERVER_AUTH: |
         $$SCONE::server_ca:crt$$
         
secrets:
  - name: server_ca_pk
    kind: private-key
  - name: server_ca
    kind: x509-ca
    private_key: server_ca_pk
  - name: server_pk
    kind: private-key
  - name: server
    kind: x509
    private_key: server_pk
    issuer: server_ca
    endpoint: server
    dns: localhost
  - name: client_ca_pk
    kind: private-key
  - name: client_ca
    kind: x509-ca
    private_key: client_ca_pk
  - name: client_pk
    kind: private-key
  - name: client
    kind: x509
    private_key: client_pk
    issuer: client_ca
    endpoint: client