// -------------read---------------------
tracepoint:syscalls:sys_enter_read /comm=="file_sys"/ 
{ 
    @read_buf[tid] = args->buf;
    @read_count[tid] = args->count;
    @read_fd[tid] = args->fd;
} 
tracepoint:syscalls:sys_exit_read /comm=="file_sys"/
{
    if (args->ret != 0) {
        printf("read %d %d %s", @read_fd[tid], args->ret, str(@read_buf[tid], @read_count[tid]));
    }
    clear(@read_buf);
    clear(@read_count);
    clear(@read_fd);
}

//--------------readv-------------------
tracepoint:syscalls:sys_enter_readv /comm=="file_sys"/ 
{ 
    @readv_buf[tid] = (args->vec)->iov_base;
    @readv_count[tid] = (args->vec)->iov_len;
    @readv_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_readv /comm=="file_sys"/
{
    if (args->ret != 0) {
        printf("readv %d %d %s", @readv_fd[tid], args->ret,  str(@readv_buf[tid], @readv_count[tid]));
    } 
    clear(@readv_buf);
    clear(@readv_count);
    clear(@readv_fd);
}

//-------------pread64------------------
tracepoint:syscalls:sys_enter_pread64 /comm=="file_sys"/ 
{
    @pread64_buf[tid] = args->buf;
    @pread64_count[tid] = args->count;
    @pread64_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_pread64 /comm=="file_sys"/ 
{
    if (args->ret != 0) {
        printf("pread64 %d %d %s", @pread64_fd[tid], args->ret, str(@pread64_buf[tid], @pread64_count[tid]));
    }
    clear(@pread64_buf);
    clear(@pread64_count);
    clear(@pread64_fd);
}

//-------------preadv-------------------
tracepoint:syscalls:sys_enter_preadv /comm=="file_sys"/ 
{
    @preadv_buf[tid] = (args->vec)->iov_base;
    @preadv_count[tid] = (args->vec)->iov_len;
    @preadv_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_preadv /comm=="file_sys"/
{
    if (args->ret != 0){
        printf("preadv %d %d %s", @preadv_fd[tid], args->ret, str(@preadv_buf[tid], @preadv_count[tid]));
    }
    clear(@preadv_buf);
    clear(@preadv_count);
    clear(@preadv_fd);
} 

//--------------write-------------------
tracepoint:syscalls:sys_enter_write /comm=="file_sys"/ 
{
    @write_buf[tid] = args->buf;
    @write_count[tid] = args->count;
    @write_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_write /comm=="file_sys"/
{
    if (args->ret != 0) {
        printf("write %d %d %s", @write_fd[tid], args->ret, str(@write_buf[tid], @write_count[tid]));
    }
    clear(@write_buf);
    clear(@write_count);
    clear(@write_fd);
}

//---------------pwrite64-----------------
tracepoint:syscalls:sys_enter_pwrite64 /comm=="file_sys"/ 
{ 
    @pwrite64_buf[tid] = args->buf;
    @pwrite64_count[tid] = args->count;
    @pwrite64_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_pwrite64 /comm=="file_sys"/
{
    if (args->ret){
        printf("pwrite %d %d %s", @pwrite64_fd[tid], args->ret, str(@pwrite64_buf[tid], @pwrite64_count[tid]));
    }
    clear(@pwrite64_buf);
    clear(@pwrite64_count);
    clear(@pwrite64_fd);
}

//----------------writev-----------------
tracepoint:syscalls:sys_enter_writev /comm=="file_sys"/ 
{
    @writev_buf[tid] = (args->vec)->iov_base;
    @writev_count[tid] = (args->vec)->iov_len;
    @writev_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_writev /comm=="file_sys"/ 
{
    if (args->ret){
        printf("writev %d %d %s", @writev_fd[tid], args->ret, str(@writev_buf[tid], @writev_count[tid]));
    }
    clear(@writev_buf);
    clear(@writev_count);
    clear(@writev_fd);
}

//---------------pwritev-----------------
tracepoint:syscalls:sys_enter_pwritev /comm=="file_sys"/ 
{ 
    @pwritev_buf[tid] = (args->vec)->iov_base;
    @pwritev_count[tid] = (args->vec)->iov_len;
    @pwritev_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_pwritev /comm=="file_sys"/ 
{
    if (args->ret){
        printf("pwritev %d %d %s", @pwritev_fd[tid], args->ret, str(@pwritev_buf[tid], @pwritev_count[tid]));
    }
    clear(@pwritev_buf);
    clear(@pwritev_count);
    clear(@pwritev_fd);
}

//-------------openat------------
tracepoint:syscalls:sys_enter_openat /comm=="file_sys"/
{
    @openat_path[tid] = args->filename;
}
tracepoint:syscalls:sys_exit_openat /comm=="file_sys"/
{
    printf("openat %d _ %s", args->ret, str(@openat_path[tid]));
    clear(@openat_path);
}


//-------------open------------
tracepoint:syscalls:sys_enter_open /comm=="file_sys"/
{
    @open_path[tid] = args->filename;
}
tracepoint:syscalls:sys_exit_open /comm=="file_sys"/
{
    printf("open %d _ %s", args->ret, str(@open_path[tid]));
    clear(@open_path);
}

//------------close--------------
tracepoint:syscalls:sys_enter_close /comm=="file_sys"/
{
    printf("close %d _ _", args->fd);
}

//------------close--------------
tracepoint:syscalls:sys_enter_close /comm=="server"/
{
    printf("close %d _ _", args->fd);
}

//---------------recvfrom------------------
tracepoint:syscalls:sys_enter_recvfrom /comm=="server"/
{
    @recvfrom_buf[tid] = args->ubuf;
    @recvfrom_count[tid] = args->size;
    @recvfrom_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_recvfrom /comm=="server"/
{
    printf("recvfrom %d %d %s", @recvfrom_fd[tid], args->ret, str(@recvfrom_buf[tid], @recvfrom_count[tid]));
    clear(@recvfrom_buf);
    clear(@recvfrom_count);
    clear(@recvfrom_fd);
}

//----------------recvmsg--------------
tracepoint:syscalls:sys_enter_recvmsg /comm=="server"/
{
    @recvmsg_buf[tid] = (args->msg)->msg_iov;
    @recvmsg_count[tid] = (args->msg)->msg_iovlen;
    @recvmsg_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_recvmsg /comm=="server"/
{
    if (args->ret){
        printf("recvmsg %d %d %s", @recvmsg_fd[tid], args->ret, str(@recvmsg_buf[tid], @recvmsg_count[tid]));
    }
    clear(@recvmsg_buf);
    clear(@recvmsg_count);
    clear(@recvmsg_fd);
}

//---------------sendto----------------------
tracepoint:syscalls:sys_enter_sendto /comm=="server"/
{
    @sendto_buf[tid] = args->buff;
    @sendto_count[tid] = args->len;
    @sendto_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_sendto /comm=="server"/
{
    printf("sendto %d %d %s", @sendto_fd[tid], args->ret, str(@sendto_buf[tid], @sendto_count[tid]));
    clear(@sendto_buf);
    clear(@sendto_count);
    clear(@sendto_fd);
}

//-------------sendmsg----------------------
tracepoint:syscalls:sys_enter_sendmsg /comm=="server"/
{
    @sendmsg_buf[tid] = ((args->msg)->msg_iov)->iov_base;
    @sendmsg_count[tid] = (args->msg)->msg_iovlen;
    @sendmsg_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_sendmsg /comm=="server"/
{
    if (args->ret){
        printf("sendmsg %d %d %s", @sendmsg_fd[tid], args->ret, str(@sendmsg_buf[tid], @sendmsg_count[tid]));
    }
    clear(@sendmsg_buf);
    clear(@sendmsg_count);
    clear(@sendmsg_fd);
}

//--------------accept4-----------
tracepoint:syscalls:sys_enter_accept4 /comm=="server"/
{
    @accept4_fd[tid] = args->fd;
    @accept4_addr[tid] = (args->upeer_sockaddr)->sa_data;
    //print((args->upeer_sockaddr)->sa_data)
}
tracepoint:syscalls:sys_exit_accept4 /comm=="server"/
{
    if (args->ret){
        printf("accept4 %d %d %s", @accept4_fd[tid], args->ret, @accept4_addr[tid]);
    }
    clear(@accept4_fd);
    clear(@accept4_addr);
}

//--------------accept-----------
tracepoint:syscalls:sys_enter_accept /comm=="server"/
{
    @accept_fd[tid] = args->fd;
    @accept_addr[tid] = (args->upeer_sockaddr)->sa_data;
    //print((args->upeer_sockaddr)->sa_data)
}
tracepoint:syscalls:sys_exit_accept /comm=="server"/
{
    if (args->ret){
        printf("accept %d %d %s", @accept_fd[tid], args->ret, @accept_addr[tid]);
    }
    clear(@accept_fd);
    clear(@accept_addr);
}

//--------------connect-----------
 tracepoint:syscalls:sys_enter_connect /comm=="server"/
{
    @connect_fd[tid] = args->fd;
    @connect_addr[tid] = (args->uservaddr)->sa_data;
    //print((args->upeer_sockaddr)->sa_data)
}
 tracepoint:syscalls:sys_exit_connect /comm=="server"/
{
    if (args->ret){
        printf("connect %d %d %s", @connect_fd[tid], args->ret, @connect_addr[tid]);
    }
    clear(@connect_fd);
    clear(@connect_addr);
}
