// -------------read---------------------
tracepoint:syscalls:sys_enter_read /comm=="threshold"/ 
{ 
    @read_buf[tid] = args->buf;
    @read_count[tid] = args->count;
    @read_fd[tid] = args->fd;
} 
tracepoint:syscalls:sys_exit_read /comm=="threshold"/
{
    printf("read %d %d %s", @read_fd[tid], args->ret, str(@read_buf[tid], @read_count[tid]));
    clear(@read_buf);
    clear(@read_count);
    clear(@read_fd);
}
    
//-------------pread64------------------
tracepoint:syscalls:sys_enter_pread64 /comm=="threshold"/ 
{
    @pread64_buf[tid] = args->buf;
    @pread64_count[tid] = args->count;
    @pread64_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_pread64 /comm=="threshold"/ 
{
    printf("pread64 %d %d %s", @pread64_fd[tid], args->ret, str(@pread64_buf[tid], @pread64_count[tid]));
    clear(@pread64_buf);
    clear(@pread64_count);
    clear(@pread64_fd);
}

//--------------readv-------------------
tracepoint:syscalls:sys_enter_readv /comm=="threshold"/ 
{ 
    @readv_buf[tid] = (args->vec)->iov_base;
    @readv_count[tid] = (args->vec)->iov_len;
    @readv_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_readv /comm=="threshold"/
{
    printf("readv %d %d %s", @readv_fd[tid], args->ret,  str(@readv_buf[tid], @readv_count[tid]));
    clear(@readv_buf);
    clear(@readv_count);
    clear(@readv_fd);
}

//-------------preadv-------------------
tracepoint:syscalls:sys_enter_preadv /comm=="threshold"/ 
{
    @preadv_buf[tid] = (args->vec)->iov_base;
    @preadv_count[tid] = (args->vec)->iov_len;
    @preadv_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_preadv /comm=="threshold"/
{
    printf("preadv %d %d %s", @preadv_fd[tid], args->ret, str(@preadv_buf[tid], @preadv_count[tid]));
    clear(@preadv_buf);
    clear(@preadv_count);
    clear(@preadv_fd);
} 

//--------------write-------------------
tracepoint:syscalls:sys_enter_write /comm=="threshold"/ 
{
    @write_buf[tid] = args->buf;
    @write_count[tid] = args->count;
    @write_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_write /comm=="threshold"/
{
    printf("write %d %d %s", @write_fd[tid], args->ret, str(@write_buf[tid], @write_count[tid]));
    clear(@write_buf);
    clear(@write_count);
    clear(@write_fd);
}

//---------------pwrite64-----------------
tracepoint:syscalls:sys_enter_pwrite64 /comm=="threshold"/ 
{ 
    @pwrite64_buf[tid] = args->buf;
    @pwrite64_count[tid] = args->count;
    @pwrite64_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_pwrite64 /comm=="threshold"/
{
    printf("pwrite %d %d %s", @pwrite64_fd[tid], args->ret, str(@pwrite64_buf[tid], @pwrite64_count[tid]));
    clear(@pwrite64_buf);
    clear(@pwrite64_count);
    clear(@pwrite64_fd);
}

//---------------pwritev-----------------
tracepoint:syscalls:sys_enter_pwritev /comm=="threshold"/ 
{ 
    @pwritev_buf[tid] = (args->vec)->iov_base;
    @pwritev_count[tid] = (args->vec)->iov_len;
    @pwritev_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_pwritev /comm=="threshold"/ 
{
    printf("pwritev %d %d %s", @pwritev_fd[tid], args->ret, str(@pwritev_buf[tid], @pwritev_count[tid]));
    clear(@pwritev_buf);
    clear(@pwritev_count);
    clear(@pwritev_fd);
}

//----------------writev-----------------
tracepoint:syscalls:sys_enter_writev /comm=="threshold"/ 
{
    @writev_buf[tid] = (args->vec)->iov_base;
    @writev_count[tid] = (args->vec)->iov_len;
    @writev_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_writev /comm=="threshold"/ 
{
    printf("writev %d %d %s", @writev_fd[tid], args->ret, str(@writev_buf[tid], @writev_count[tid]));
    clear(@writev_buf);
    clear(@writev_count);
    clear(@writev_fd);
}

//----------------pwritev2--------------
tracepoint:syscalls:sys_enter_pwritev2 /comm=="threshold"/ 
{
    @pwritev2_buf[tid] = (args->vec)->iov_base;
    @pwritev2_count[tid] = (args->vec)->iov_len;
    @pwritev2_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_pwritev2 /comm=="threshold"/ 
{
    printf("pwritev2 %d %d %s", @pwritev2_fd[tid], args->ret, str(@pwritev2_buf[tid], @pwritev2_count[tid]));
    clear(@pwritev2_buf);
    clear(@pwritev2_count);
    clear(@pwritev2_fd);
}

//---------------recvfrom------------------
tracepoint:syscalls:sys_enter_recvfrom /comm=="threshold"/
{
    @recvfrom_buf[tid] = args->ubuf;
    @recvfrom_count[tid] = args->size;
    @recvfrom_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_recvfrom /comm=="threshold"/
{
    printf("recvfrom %d %d %s", @recvfrom_fd[tid], args->ret, str(@recvfrom_buf[tid], @recvfrom_count[tid]));
    clear(@recvfrom_buf);
    clear(@recvfrom_count);
    clear(@recvfrom_fd);
}

//----------------recvmsg--------------
tracepoint:syscalls:sys_enter_recvmsg /comm=="threshold"/
{
    @recvmsg_buf[tid] = (args->msg)->msg_iov;
    @recvmsg_count[tid] = (args->msg)->msg_iovlen;
    @recvmsg_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_recvmsg /comm=="threshold"/
{
    printf("recvmsg %d %d %s", @recvmsg_fd[tid], args->ret, str(@recvmsg_buf[tid], @recvmsg_count[tid]));
    clear(@recvmsg_buf);
    clear(@recvmsg_count);
    clear(@recvmsg_fd);
}

//----------------mq_timedreceive-----------
//tracepoint:syscalls:sys_enter_mq_timedreceive /comm=="threshold"/
//{
//    @mq_timedreceive_buf[tid] = args->u_msg_ptr;
//    @mq_timedreceive_count[tid] = args->msg_len;
//}
//tracepoint:syscalls:sys_exit_mq_timedreceive /comm=="threshold"/
//{
//    printf("mq_timedreceive %s", str(@mq_timedreceive_buf[tid], @mq_timedreceive_count[tid]));
//    clear(@mq_timedreceive_buf);
//    clear(@mq_timedreceive_count);
//}

//-----------------readlink------------------
//tracepoint:syscalls:sys_enter_readlink /comm=="threshold"/
//{
//    @readlink_buf[tid] = args->buf;
//    @readlink_count[tid] = args->bufsiz;
//}
//tracepoint:syscalls:sys_exit_readlink /comm=="threshold"/
//{
//    printf("readlink %d %s", args->ret, str(@readlink_buf[tid], @readlink_count[tid]));
//    clear(@readlink_buf);
//   clear(@readlink_count);
//}

//----------------readlinkat-----------------
//tracepoint:syscalls:sys_enter_readlinkat /comm=="threshold"/
//{
//    @readlinkat_buf[tid] = args->buf;
//    @readlinkat_count[tid] = args->bufsiz;
//}
//tracepoint:syscalls:sys_exit_readlinkat /comm=="threshold"/
//{
//    printf("readlinkat %s", str(@readlinkat_buf[tid], @readlinkat_count[tid]));
//    clear(@readlinkat_buf);
//    clear(@readlinkat_count);
//}

//---------------sendto----------------------
tracepoint:syscalls:sys_enter_sendto /comm=="threshold"/
{
    @sendto_buf[tid] = args->buff;
    @sendto_count[tid] = args->len;
    @sendto_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_sendto /comm=="threshold"/
{
    printf("sendto %d %d %s", @sendto_fd[tid], args->ret, str(@sendto_buf[tid], @sendto_count[tid]));
    clear(@sendto_buf);
    clear(@sendto_count);
    clear(@sendto_fd);
}

//-------------sendmsg----------------------
tracepoint:syscalls:sys_enter_sendmsg /comm=="threshold"/
{
    @sendmsg_buf[tid] = ((args->msg)->msg_iov)->iov_base;
    @sendmsg_count[tid] = (args->msg)->msg_iovlen;
    @sendmsg_fd[tid] = args->fd;
}
tracepoint:syscalls:sys_exit_sendmsg /comm=="threshold"/
{
    printf("sendmsg %d %d %s", @sendmsg_fd[tid], args->ret, str(@sendmsg_buf[tid], @sendmsg_count[tid]));
    clear(@sendmsg_buf);
    clear(@sendmsg_count);
    clear(@sendmsg_fd);
}